<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Intercambio Secreto</title>
<style>
  body{font-family:Arial;background:#101827;color:#e2e8f0;margin:0;padding:32px;text-align:center}
  input,button{padding:10px 14px;border-radius:8px;border:none;font-size:16px}
  input{width:220px;margin-bottom:12px}
  button{cursor:pointer;background:#2563eb;color:white;margin:6px}
  button:disabled{background:#555;cursor:not-allowed}
</style>
</head>
<body>
<h1>Intercambio Secreto</h1>
<p>Escribe tu nombre para saber qui√©n te toc√≥.</p>

<input id="yourName" placeholder="Tu nombre" autocomplete="off" /> <br>
<button id="revealBtn">Obtener persona</button>

<p id="msg"></p>

<script>
  // --------------------------------------
// MODO ADMIN OCULTO (solo si ?admin=1)
// --------------------------------------
if (new URLSearchParams(window.location.search).get("admin") === "1") {
  const adminBtn = document.createElement("button");
  adminBtn.textContent = "üîß Reiniciar pruebas (modo admin)";
  adminBtn.style.marginTop = "20px";
  adminBtn.style.background = "#ef4444";
  adminBtn.style.color = "white";
  adminBtn.style.fontWeight = "bold";

  adminBtn.onclick = () => {
    if (!confirm("¬øSeguro que quieres limpiar el localStorage y reiniciar todo?")) return;
    
    // Borrar bloqueos
    localStorage.removeItem("usedNames");
    usedNames = [];

    // Regenerar asignaciones
    generateAssignments();

    alert("Modo admin: localStorage reseteado y asignaciones regeneradas.");
  };

  document.body.appendChild(adminBtn);
}

// Participantes definidos en el c√≥digo
let participants = [
  "Villa", "Emiliano", "Luis", "Seth", "Paulo", "Xander", "Bogart"
];

// Asignaciones fijas (derangement) ‚Äî pueden venir generadas antes
let assignments = [];

// Genera asignaciones sin que nadie se toque a s√≠ mismo
function generateAssignments(){
  let receivers = [...participants];
  do{
    receivers.sort(()=>Math.random()-0.5);
  }while(receivers.some((x,i)=>x===participants[i]));
  assignments = participants.map((g,i)=>({giver:g, receiver:receivers[i]}));
}

generateAssignments();

// BLOQUEO POR NOMBRE (global)
// Guardamos nombres ya usados en localStorage
let usedNames = JSON.parse(localStorage.getItem("usedNames") || "[]");

function saveUsed(name){
  if(!usedNames.includes(name)){
    usedNames.push(name);
    localStorage.setItem("usedNames", JSON.stringify(usedNames));
  }
}

// BOT√ìN PRINCIPAL
const btn = document.getElementById("revealBtn");
const msg = document.getElementById("msg");

btn.addEventListener("click", ()=>{
  const name = document.getElementById("yourName").value.trim();

  if(!name) return alert("Escribe tu nombre primero.");
  if(!participants.includes(name)) return alert("Ese nombre no est√° en la lista.");

  // BLOQUEO GLOBAL POR NOMBRE
  if(usedNames.includes(name)){
    msg.textContent = `El usuario "${name}" ya obtuvo su persona.`;
    return;
  }

  // Confirmaci√≥n
  if(!confirm(`¬øSeguro que eres ${name}? Solo podr√°s ver tu persona una vez.`)) return;

  // Buscar asignaci√≥n
  const pair = assignments.find(a=>a.giver===name);
  if(!pair) return alert("Error: no se encontr√≥ tu asignaci√≥n.");

  // Guardar bloqueo
  saveUsed(name);

  // Redirigir al resultado
  window.location.href = `resultado.html?p=${encodeURIComponent(pair.receiver)}`;
});
</script>
</body>
</html>
